# Working with Node.js and Express REST API to access the MySQL database to perform CRUD Operations using Sequelize

This example explains Node.js application with REST API to perform CRUD operations using MySQL Database with Sequelize package

Step 1: Install Sequelize and Sequelize-Auto in global scope usig the following command
    npm install -g sequelize sequelize-auto mysql2

Step 2: Create a folder of name nodemysqlorm and open this folder in Visual Studio Code (VSCode). Open the Command Prompt (or terminal window on Linux/macOS) and navigate to the nodemysqlorm folder.

Step 3: Run the following command to create package.json file in thie project

    npm init -y

Step 4: Run the following command to install express, mysql2, sequelize, sequelize-auto, cors, body-parser, cors packages in the current project

npm install @types/node express cors body-parser sequelize sequelize-auto mysql2

Step 5: The Sequelize module is used to perform the Data Access Operations using Object-Relational-Mapping (ORM). We can generate the JavaScript objects those are mapped  with the Database Tables. To generate the JavaScript models, run the following command from the command prompt

sequelize-auto -h localhost -d Company -u root -x P@ssw0rd_ --dialect mysql -t Department, Employee

Once this command is executed successfully, the 'models' project is added in to the project and tis folder is added with Departmenty.js, Employee.js and init-models.js files. 

Step 6: In the project add a new file and name this file as 'service.js'. In this file add the following code. This code using Express.js object model to create REST APIs.

````javascript

// @ts-nocheck

// 1. Load packages 

const express = require('express');
const bodyParser =  require('body-parser');
const cors = require('cors');
const path = require('path');
const { Sequelize, Model, DataTypes } = require('sequelize');
let instance = express();
instance.use(bodyParser.json());
instance.use(bodyParser.urlencoded({ extended: false }));
instance.use(cors());

// 2. define the database connection

const sequelize = new Sequelize("Company", "root", "P@ssw0rd_", {
    host: 'localhost',
    dialect: 'mysql',
    pool: {
        max: 5,
        min: 0,
        idle: 10000
    },
    define: {
        timestamps: false // supressing the TimeStamp generated by ORM
    }
});

// 3. lets import packages

 
const dept = require(path.join(__dirname, './models/Department'))(sequelize, Sequelize.DataTypes);


// 4. sync the model with the database using sequelize

instance.get('/api/departments', (req, resp) => {
    let id = parseInt(req.params.id);
    sequelize.sync({
            force: false // default is true to create a table
        })
        .then(() =>
            dept.findAll()
        )
        .then((data) => {
            resp.json({ stausCode: 200, rowCount: data.length, response: data });
            resp.end();
        })
        .catch((error) => resp.send({ statusCode: 500, data: error }));
});


instance.get('/api/departments/:id', (req, resp) => {
    let id = parseInt(req.params.id);
    sequelize.sync({
            force: false // default is true to create a table
        })
        .then(() =>
            dept.findOne({ where: { DeptId: id } })
        )
        .then((data) => {
            resp.json({ statusCode: 200, data: data })
            resp.end();
        })
        .catch((error) => resp.send({ statusCode: 500, data: error }));
});

instance.post('/api/departments', (req, resp) => {
    let dept1 = {
        DeptId: parseInt(req.body.DeptId),
        DeptNo: req.body.DeptNo,
        DeptName: req.body.DeptName,
        Location: req.body.Location,
        Capacity: parseInt(req.body.Capacity),
    };
    console.log(JSON.stringify(dept));
    sequelize.sync({
            force: false // default is true to create a table
        })
        .then(() => {
            return dept.create(dept1);
        })
        .then((data) => {
            resp.json({ statusCode: 200, data: data.toJSON() })
            resp.end();
        })
        .catch((error) => resp.send({ statusCode: 500, data: error }));
});

instance.put('/api/departments/:id', (req, resp) => {
    let id = req.params.id;
    sequelize.sync({
            force: false // default is true to create a table
        })
        .then(() =>
            dept.update({
               // DeptNo: req.body.DeptNo,
                DeptName: req.body.DeptName,
                Location: req.body.Location,
                Capacity: parseInt(req.body.Capacity)
            }, { where: { DeptNo: id } })
        )
        .then((response) => {
            if (response.length === 0) {
                resp.json({ data: 'The record is not updated ' });
            } else {
                resp.json({ data: response });
            }
        })
        .catch((error) => resp.send({ statusCode: 500, data: `Error in Update ${error}` }));
});


instance.delete('/api/departments/:id', (req, resp) => {
    let id = req.params.id;
    sequelize.sync({
            force: false // default is true to create a table
        })
        .then(() =>
            dept.destroy({ where: { DeptNo: id } })
        )
        .then((response) => {
            if (response.length === 0) {
                resp.json({ data: 'The record not found since cannot not be deleted ' });
            } else {
                resp.json({ data: response });
            }
        })
        .catch((error) => resp.send({ statusCode: 500, data: `Error in Delete ${error}` }));
});


// 4. listen on the port
instance.listen(6060, () => {
    console.log('Express Server Started on port 5060');
});
````